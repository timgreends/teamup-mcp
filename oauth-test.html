<!DOCTYPE html>
<html>
<head>
    <title>TeamUp OAuth Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        input, select { width: 100%; padding: 5px; margin: 5px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>TeamUp OAuth Token Generator</h1>
    
    <div class="section">
        <h2>Step 1: Configure OAuth Application</h2>
        <p>Enter your OAuth application credentials from TeamUp Settings → Integrations → Customer API</p>
        
        <label>Client ID:</label>
        <input type="text" id="clientId" placeholder="your-client-id">
        
        <label>Client Secret:</label>
        <input type="password" id="clientSecret" placeholder="your-client-secret">
        
        <label>Redirect URI (must match exactly):</label>
        <input type="text" id="redirectUri" value="http://localhost:8080/callback">
        
        <label>Scope:</label>
        <select id="scope">
            <option value="read">read</option>
            <option value="read_write" selected>read_write</option>
        </select>
    </div>
    
    <div class="section">
        <h2>Step 2: Start Authorization</h2>
        <button onclick="startAuth()">Start OAuth Flow</button>
        <p id="authStatus"></p>
    </div>
    
    <div class="section">
        <h2>Step 3: Exchange Code for Token</h2>
        <p>After authorizing, you'll be redirected back. Paste the full URL here:</p>
        <input type="text" id="callbackUrl" placeholder="http://localhost:8080/callback?code=...">
        <button onclick="exchangeToken()">Exchange for Token</button>
        <p id="tokenStatus"></p>
        <pre id="tokenResult"></pre>
    </div>
    
    <div class="section">
        <h2>Step 4: Test Token</h2>
        <button onclick="testToken()">Test Provider Mode</button>
        <pre id="testResult"></pre>
    </div>

    <script>
        function startAuth() {
            const clientId = document.getElementById('clientId').value;
            const redirectUri = document.getElementById('redirectUri').value;
            const scope = document.getElementById('scope').value;
            
            if (!clientId) {
                document.getElementById('authStatus').innerHTML = '<span class="error">Please enter Client ID</span>';
                return;
            }
            
            const state = Math.random().toString(36).substring(7);
            localStorage.setItem('oauth_state', state);
            
            const params = new URLSearchParams({
                client_id: clientId,
                redirect_uri: redirectUri,
                response_type: 'code',
                scope: scope,
                state: state
            });
            
            const authUrl = `https://goteamup.com/api/auth/authorize?${params.toString()}`;
            
            document.getElementById('authStatus').innerHTML = 
                `<span class="success">Opening authorization page...</span><br>
                 <a href="${authUrl}" target="_blank">Click here if it doesn't open</a>`;
            
            window.open(authUrl, '_blank');
        }
        
        async function exchangeToken() {
            const clientId = document.getElementById('clientId').value;
            const clientSecret = document.getElementById('clientSecret').value;
            const callbackUrl = document.getElementById('callbackUrl').value;
            
            try {
                const url = new URL(callbackUrl);
                const code = url.searchParams.get('code');
                const state = url.searchParams.get('state');
                
                if (!code) {
                    throw new Error('No code found in callback URL');
                }
                
                // Note: This won't work due to CORS, but shows the correct request format
                document.getElementById('tokenStatus').innerHTML = 
                    '<span class="error">Due to CORS, you need to make this request from a server. Use this curl command:</span>';
                
                const curlCommand = `curl -X POST https://goteamup.com/api/auth/access_token \\
  -H "Content-Type: application/x-www-form-urlencoded" \\
  -d "client_id=${clientId}" \\
  -d "client_secret=${clientSecret}" \\
  -d "code=${code}"`;
                
                document.getElementById('tokenResult').textContent = curlCommand;
                localStorage.setItem('oauth_code', code);
                
            } catch (error) {
                document.getElementById('tokenStatus').innerHTML = 
                    `<span class="error">Error: ${error.message}</span>`;
            }
        }
        
        function testToken() {
            const token = prompt('Enter the access token from the curl command:');
            if (!token) return;
            
            const testCommand = `# Test customer mode
curl -H "Authorization: Token ${token}" \\
     -H "TeamUp-Provider-ID: 54664" \\
     -H "TeamUp-Request-Mode: customer" \\
     https://goteamup.com/api/v2/events?page_size=1

# Test provider mode  
curl -H "Authorization: Token ${token}" \\
     -H "TeamUp-Provider-ID: 54664" \\
     -H "TeamUp-Request-Mode: provider" \\
     https://goteamup.com/api/v2/events?page_size=1`;
     
            document.getElementById('testResult').textContent = testCommand;
        }
    </script>
</body>
</html>